{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>Bill Summary</title>
  <link rel="stylesheet" href="{% static 'pos/style.css' %}">
</head>
<body>

{% if messages %}
  <div class="toast">
    {% for m in messages %}
      <div class="msg">{{ m }}</div>
    {% endfor %}
  </div>
{% endif %}

<div class="topbar">
  <div class="left">
    <a href="{% url 'pos:choose_zone' %}" class="btn dark">â¬… Back</a>
    <h2>ğŸ§¾ Bill Summary</h2>
  </div>
  <div class="right">
    <span class="billno">{{ bill.bill_no }}</span>
    <span class="tag">{{ category }}</span>
  </div>
</div>

<div class="grid2">

  <div class="card">
    <h3>ğŸ‘¤ Customer</h3>
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="action" value="save_customer">

      <input name="customer_name" placeholder="Name" value="{% if bill.customer %}{{ bill.customer.name }}{% endif %}" required>
      <input name="customer_phone" placeholder="Phone (optional)" value="{% if bill.customer %}{{ bill.customer.phone }}{% endif %}">
      <input name="customer_email" placeholder="Email (required)" value="{% if bill.customer %}{{ bill.customer.email }}{% endif %}" required>

      <button class="btn">âœ… Save Customer</button>
    </form>

    <hr>

    <!-- <div class="status-box">
  <p>ğŸ± Pool Table 1:
    {% if pool1_busy %}
      <span class="busy">BUSY</span>
    {% else %}
      <span class="free">FREE</span>
    {% endif %}
  </p>

  <p>ğŸ± Pool Table 2:
    {% if pool2_busy %}
      <span class="busy">BUSY</span>
    {% else %}
      <span class="free">FREE</span>
    {% endif %}
  </p>

  <p>ğŸ® PS5 65":
    {% if ps5_65_busy %}
      <span class="busy">BUSY</span>
    {% else %}
      <span class="free">FREE</span>
    {% endif %}
  </p>

  <p>ğŸ® PS5 55":
    {% if ps5_55_busy %}
      <span class="busy">BUSY</span>
    {% else %}
      <span class="free">FREE</span>
    {% endif %}
  </p>
</div> -->

  </div>

  <div class="card">
    <h3>ğŸ·ï¸ Discounts</h3>
    {% if bill.customer %}
<form method="post">
  {% csrf_token %}
  <input type="hidden" name="action" value="apply_discount">

  <label>Discount (%)</label>
  <input type="number" name="discount_percent" value="">

  <!-- <label>Gaming Discount (Rs.)</label>
  <input type="number" name="game_disc_amount" value="{{ bill.game_discount_amount }}"> -->

  <button class="btn">âœ… Apply</button>
</form>
{% else %}
<p class="note">âš  Save Customer details first to enable discounts.</p>
<!-- <button class="btn dark" disabled>âœ… Apply</button> -->
{% endif %}

    <hr>

    <div class="summary">
      <p>Discount <span>Rs. {{ totals.discount_amount }}</span></p>
      <!-- <p>Game Total <span>Rs. {{ totals.game_total }}</span></p>
      <p>Combo Total <span>Rs. {{ totals.combo_total }}</span></p> -->
      <!-- <p>Discount <span>- Rs. {{ totals.Overall_Discount_percent }}</span></p> -->
      <!-- <p>Game Discount <span>- Rs. {{ totals.game_discount }}</span></p> -->
      <div class="grand">
        <b>Total</b>
        <b>Rs. {{ totals.grand_total }}</b>
      </div>
    </div>
  </div>

</div>

<div class="card wide">
  <div class="bill-actions">
  {% if bill.customer %}
    <a href="{% url 'pos:add_food' %}" class="btn">â• Food</a>
    <a href="{% url 'pos:add_pool' %}" class="btn">â• Pool</a>
    <a href="{% url 'pos:add_ps5' %}" class="btn">â• PS5</a>
    <a href="{% url 'pos:add_combo' %}" class="btn">â• Combo</a>
  {% else %}
    <!-- <button class="btn dark" disabled>â• Food</button>
    <button class="btn dark" disabled>â• Pool</button>
    <button class="btn dark" disabled>â• PS5</button>
    <button class="btn dark" disabled>â• Combo</button> -->
    <p class="note">âš  Save customer email first to start billing.</p>
  {% endif %}
</div>


  <h3>ğŸ§¾ Items</h3>

  {% if items %}
  <table class="table">
    <tr>
      <th>Item</th>
      <th>Qty</th>
      <th>Amt</th>
      <th>Remove</th>
    </tr>
    {% for i in items %}
    <tr>
      <td>{{ i.item_name }}</td>
      <td>{% if i.category == "GAME" %}{{ i.quantity }} hr{% else %}{{ i.quantity }}{% endif %}</td>
      <td>Rs. {{ i.total }}</td>
      <td><a class="remove" href="{% url 'pos:remove_item' i.id %}">âŒ</a></td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
    <p class="note">No items yet. Add something from buttons above âœ…</p>
  {% endif %}

  <div class="paybar">
    <a href="{% url 'pos:choose_zone' %}" class="btn dark">â¬… Add More</a>

    <form method="post" action="{% url 'pos:mark_paid' %}">
      {% csrf_token %}
      <button class="btn pay">âœ… Mark Paid & Print</button>
    </form>

    <a href="{% url 'pos:dashboard' %}" class="btn dark">ğŸ“Š Dashboard</a>
  </div>
</div>

</body>
</html>
